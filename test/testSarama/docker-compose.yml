version: '3.0'
services:
# https://github.com/RonnanSouza/kafka_environment/blob/master/docker-compose.yml
  zookeeper:
    image: wurstmeister/zookeeper:3.4.6
    expose:
      - "2181"
    restart: always
    container_name: zookeeper

  kafkaservice:
    image: wurstmeister/kafka:2.12-2.3.0
    depends_on:
      - zookeeper
    ports:
      - "9093:9093"
    expose:
      - "9092"
    environment:
      KAFKA_CREATE_TOPICS: "toBucket:2:2,toCore:2:2,toHeartbeat:2:2,toStream:2:2"
      KAFKA_ADVERTISED_LISTENERS: INSIDE://kafkaservice:9092,OUTSIDE://kafkaservice:9093
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT
      KAFKA_LISTENERS: INSIDE://0.0.0.0:9092,OUTSIDE://0.0.0.0:9093
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_INTER_BROKER_LISTENER_NAME: INSIDE
    restart: always
    container_name: kafkaservice
  
    # app part
  frontendservice:
    build: 
      context: ../../src/
      dockerfile: frontend/Dockerfile
    ports:
      - "80:80"
  
  converterserver:
    build:
      context: ../../src/
      dockerfile: converterserverservice/Dockerfile
    ports:
      - "3001:3001"
    depends_on:
      - kafkaservice
    container_name: converterserver

  bucketuploader:
    build:
      context: ../../src/
      dockerfile: bucketuploaderservice/Dockerfile
    
    depends_on:
      - kafkaservice
      - converterserver
